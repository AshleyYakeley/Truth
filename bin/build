#!/bin/bash -e
if [ -z "${BINPATH}" ]; then
    export BINPATH=`stack path --local-bin`
fi
docker build -t local-build docker
bin/hindent-all
stack install --test --bench --haddock
mkdir -p mkdocs/generated
$BINPATH/pinafore --doc-predefined > mkdocs/generated/predefined.md
$BINPATH/pinafore --doc-infix > mkdocs/generated/infix.md
mkdir -p mkdocs/generated/examples
cp pinafore/examples/* mkdocs/generated/examples/
stack exec -- pip3 install --user file://`pwd`/support/pygments-lexer/
stack exec --cwd mkdocs -- mkdocs build
echo OK
