#!/bin/bash -e
if [ -z "${BINPATH}" ]; then
    export BINPATH=`stack path --local-bin`
fi
docker build -t local-build docker
bin/hindent-all
stack install --test --bench --haddock
install -m 755 --strip "$BINPATH/pinafore" "${XDG_DATA_HOME:-$HOME/.local/share}/../bin/"
mkdir -p mkdocs/generated
$BINPATH/pinafore --doc-predefined > mkdocs/generated/predefined.md
$BINPATH/pinafore --doc-infix > mkdocs/generated/infix.md
stack exec --cwd mkdocs -- mkdocs build
echo OK
